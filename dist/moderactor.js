var Moderaction=function(){"use strict";class t{async get(t){throw new Error("Adapter.get not implemented")}async post(t,e){throw new Error("Adapter.post not implemented")}async getForm(t,e){throw new Error("Adapter.getForm not implemented")}bridge(t){throw new Error("Adapter.bridge not implemented")}get tid(){return null}get pagetype(){return""}}function e(t){return(new DOMParser).parseFromString(t,"text/html")}async function r(t,r){const n=function(t){var e=new FormData;for(var r in t)e.append(r,t[r]);return[...e.entries()].map(t=>`${encodeURIComponent(t[0])}=${encodeURIComponent(t[1])}`).join("&")}(r),o=await fetch(t,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:n}),s=await o.text();return{ok:o.ok,status:o.status,text:s,doc:e(s)}}const n={get tid(){return function(){const t=document.querySelector("input[name=tid]");if(t?.value)return t.value;const e=document.querySelector("a[href*='&tid=']"),r=(e?.getAttribute("href")||"").match(/[?&]tid=([a-z0-9]+)/i);if(r)return r[1];const n=location.pathname,o=n.match(/\/t(\d+)(?:p\d+)?-/);if(o)return o[1];const s=n.match(/\/f(\d+)(?:p\d+)?-/);return s?s[1]:null}()},get pagetype(){return function(){const t=location.pathname;if(/^\/t\d+(p\d+)?-/.test(t))return"topic";if(/^\/f\d+(p\d+)?-/.test(t))return"forum";if(/^\/c\d+-/.test(t))return"category";if(/^\/u\d+-/.test(t))return"profile";const e=(t+location.search).match(/\/modcp\?mode=([^&]+)/);return e?e[1]:""}()},get resid(){return function(){const t=location.pathname;let e=t.match(/^\/[tfc](\d+)(?:p\d+)?-/);return e||(e=t.match(/^\/u(\d+)/)),e?Number(e[1]):0}()},get pagenum(){return function(){const t=location.pathname.match(/^\/[tf]\d+(p\d+)-/);return t?Number(t[1].slice(1)):0}()},get charset(){return(document.charset||document.characterSet||"utf-8").toLowerCase()}};function o(t,e){return Array.from(t.querySelectorAll(e))}function s(t){const{doc:e,text:r}=t,n=function(t){return Array.from(t.querySelectorAll("p")).map(t=>t.textContent.trim()).join(" ").replace(/\s+/g," ").trim()}(e),s=(i="a[href]",e.querySelector(i)||void 0);var i;const a=s?s.getAttribute("href"):"",u=function(t){const e={};if(!t)return e;const r=t.match(/\/(?:t|viewtopic\?.*?t=)(\d+)/);r&&(e.topic_id=Number(r[1]));const n=t.match(/\/f(\d+)-/);n&&(e.forum_id=Number(n[1]));const o=t.match(/#(\d+)$/);return o&&(e.post_id=Number(o[1])),e}(a),c=function(t){const e=(t||"").toLowerCase();return/déplacé/.test(e)?"topic.move":/verrouill/.test(e)&&!/déverrouill/.test(e)?"topic.lock":/déverrouill/.test(e)?"topic.unlock":/supprim/.test(e)?"topic.delete":/corbeille|poubelle/.test(e)?"topic.trash":/répon|enregistré avec succès/.test(e)?"topic.post":/nouveau sujet/.test(e)?"forum.post":/message priv/.test(e)?"user.pm":/banni/.test(e)?"user.ban":/débanni|unban/.test(e)?"user.unban":"unknown"}(n),d=function(t,e){const r=(e||"").toLowerCase();switch(t){case"topic.move":return/déplacé/.test(r);case"topic.lock":return/verrouill/.test(r);case"topic.unlock":return/déverrouill/.test(r);case"topic.delete":return/supprim/.test(r);case"topic.trash":return/corbeille|poubelle/.test(r);case"topic.post":return/répon|enregistré avec succès/.test(r);case"forum.post":return/nouveau sujet/.test(r);case"user.pm":return/message priv/.test(r);case"user.ban":return/banni/.test(r);case"user.unban":return/débanni|unban/.test(r);default:return!1}}(c,n),p={first:a||void 0,topic:o(e,'a[href^="/t"], a[href*="viewtopic"]').map(t=>t.getAttribute("href"))[0]||void 0,forum:o(e,'a[href^="/f"]').map(t=>t.getAttribute("href"))[0]||void 0};return{ok:d,status:t.status,action:c,message:n,ids:u,links:p,href:a,raw:r}}const i=new class extends t{async get(t){return async function(t){const r=await fetch(t,{credentials:"same-origin"}),n=await r.text();return{ok:r.ok,status:r.status,text:n,doc:e(n)}}(t)}async post(t,e){return r(t,e)}async getForm(t,e){const r=await this.get(t);if(!r.ok)return{ok:!1,status:r.status,text:r.text};const n=r.doc.querySelector(e);if(!n)return{ok:!1,status:404,text:"Form not found"};const o=new FormData(n);return{ok:!0,data:Object.fromEntries(o.entries()),doc:r.doc}}bridge(t){return s(t)}get tid(){return n.tid}get pagetype(){return n.pagetype}},a=Array.isArray;function u(t){return(e=t,null==e?[]:a(e)?e:[e]).filter(t=>null!=t).map(t=>"number"==typeof t?t:parseInt(String(t),10)).filter(t=>Number.isFinite(t)&&t>0);var e}const c=t=>t?Array.from(t.childNodes).filter(t=>t.nodeType===Node.TEXT_NODE).map(t=>t.nodeValue.trim()).filter(Boolean).join(" "):"";class d{constructor(t,e){this.ids=u(t),this.adapter=e}_all(t){return Promise.all(t)}}class p extends d{async post(t){const{subject:e,message:r,notify:n=0}=t||{};if(!e||!r)throw new Error("Forum.post: subject et message sont requis");const o=this.ids.map(t=>this.adapter.post("/post",{post:1,mode:"newtopic",f:t,subject:e,message:r,notify:n}).then(t=>this.adapter.bridge(t)));return this._all(o)}}class l extends d{async post(t){const{message:e,notify:r=0}=t||{};if(!e)throw new Error("Topic.post: message est requis");const n=this.ids.map(t=>this.adapter.post("/post",{post:1,mode:"reply",t:t,message:e,notify:r}).then(t=>this.adapter.bridge(t)));return this._all(n)}async lock(){const t=this.adapter.tid;if(!t)throw new Error("Topic.lock: tid introuvable");const e=this.ids.map(e=>this.adapter.get(`/modcp?mode=lock&t=${e}&tid=${t}`).then(t=>this.adapter.bridge(t)));return this._all(e)}async unlock(){const t=this.adapter.tid;if(!t)throw new Error("Topic.unlock: tid introuvable");const e=this.ids.map(e=>this.adapter.get(`/modcp?mode=unlock&t=${e}&tid=${t}`).then(t=>this.adapter.bridge(t)));return this._all(e)}async move(t){if(!t)throw new Error("Topic.move: forum id manquant");const e=this.adapter.tid;if(!e)throw new Error("Topic.move: tid introuvable");const r=this.ids.map(r=>this.adapter.post(`/modcp?tid=${e}`,{tid:e,new_forum:"f"+t,mode:"move",t:r,confirm:1}).then(t=>this.adapter.bridge(t)));return this._all(r)}async trash(){const t=this.adapter.tid;if(!t)throw new Error("Topic.trash: tid introuvable");const e=this.ids.map(e=>this.adapter.get(`/modcp?mode=trash&t=${e}&tid=${t}`).then(t=>this.adapter.bridge(t)));return this._all(e)}async delete(){const t=this.adapter.tid;if(!t)throw new Error("Topic.remove: tid introuvable");const e=this.ids.map(e=>this.adapter.post(`/modcp?tid=${t}`,{t:e,mode:"delete",confirm:1}).then(t=>this.adapter.bridge(t)));return this._all(e)}}class m extends d{async delete(){const t=this.ids.map(t=>this.adapter.post("/post",{p:t,mode:"delete",confirm:""}).then(t=>this.adapter.bridge(t)));return this._all(t)}async update({message:t}){if(!t)throw new Error("Post.update: message requis");const e=this.ids.map(async e=>{const r=await this.adapter.getForm(`/post?p=${e}&mode=editpost`,'form[name="post"]');if(!r.ok)return r;const n={...r.data,message:t};n.post=1;const o=await this.adapter.post("/post",n);return this.adapter.bridge(o)});return this._all(e)}}class f extends d{async pm({subject:t,message:e}){if(!t||!e)throw new Error("User.pm: subject et message requis");const r=this.ids.join(", "),n=await this.adapter.post("/privmsg",{username:r,mode:"post",post:1,subject:t,message:e});return this.adapter.bridge(n)}async ban({days:t=0,reason:e=""}={}){const r=this.adapter.tid;if(!r)throw new Error("User.ban: tid introuvable");const n=this.ids.map(n=>this.adapter.post(`/modcp?tid=${r}`,{tid:r,confirm:1,mode:"ban",user_id:n,ban_user_date:t,ban_user_reason:e}).then(t=>this.adapter.bridge(t)));return this._all(n)}async unban(){const t=this.adapter.tid;if(!t)throw new Error("User.unban: tid introuvable");const e=await this.adapter.post(`/admin/index.forum?part=users_groups&sub=users&mode=ban_control&extended_admin=1&tid=${t}`,{users_to_unban:this.ids,unban_users:1});return this.adapter.bridge(e)}}class h extends d{constructor(t){super([],t)}async post({message:t}){if(!t)throw new Error("Chat.post: message requis");return await this.adapter.post("/chatbox/actions.forum",{method:"send",archive:0,message:t}),{ok:!0}}}function g(t){try{const e=(t?.textContent||"").trim();if(!e)return[];return function(t){const e=Array.isArray(t)?t:[t],r=[];for(const t of e)t&&Array.isArray(t["@graph"])?r.push(...t["@graph"]):r.push(t);return r.filter(t=>t&&"object"==typeof t&&t["@type"])}(JSON.parse(e))}catch{return[]}}const b=new Map([["BreadcrumbList",function(t){if("BreadcrumbList"!==t["@type"]||!Array.isArray(t.itemListElement))return null;const e=t.itemListElement.filter(t=>t&&"ListItem"===t["@type"]&&t.item).map(t=>({position:Number(t.position)||null,url:t.item&&(t.item["@id"]||t.item.url)||null,name:t.item&&t.item.name||null}));return e.length?{type:"BreadcrumbList",items:e}:null}],["DiscussionForumPosting",function(t){if("DiscussionForumPosting"!==t["@type"])return null;const e=t.interactionStatistic||{},r=Number(e.userInteractionCount)||null;return{type:"DiscussionForumPosting",headline:t.headline||null,name:t.name||null,url:t.url||null,datePublished:t.datePublished||null,dateModified:t.dateModified||null,pageStart:Number(t.pageStart)||null,pageEnd:Number(t.pageEnd)||null,author:t.author?.name||null,author_url:t.author?.url||null,publisher:t.publisher?.name||null,logo:t.publisher?.logo?.url||null,image:t.image||null,interactionCount:r}}]]);function y(t=document,e){const r=function(t=document){return Array.from(t.querySelectorAll('script[type="application/ld+json"]'))}(t),n={},o=[];for(const t of r){const r=g(t);for(const t of r){const r=Array.isArray(t["@type"])?t["@type"][0]:t["@type"];if(o.push(t),e&&!e.includes(r))continue;const s=b.get(r);if(s){const e=s(t);e&&(n[r]||(n[r]=[]),n[r].push(e))}}}return{byType:n,all:o}}function w(t,{pageSizeOverride:e,defaultPageSize:r=50}={}){const n={current:void 0,total:void 0,page_size_detected:void 0},o=t.querySelector(".pagination")||t.querySelector(".pagelink")||t.querySelector(".topic-actions .pagination");if(o){const t=o.textContent.replace(/\s+/g," ").trim().toLowerCase().match(/page\s+(\d+)\s+(?:sur|of)\s+(\d+)/i);t&&(n.current=Number(t[1]),n.total=Number(t[2]))}let s=Number.isFinite(e)?e:void 0;if(!s&&o)for(const t of o.querySelectorAll("script")){const e=(t.textContent||"").match(/start\s*=\s*\(start\s*-\s*1\)\s*\*\s*(\d+)/);if(e){s=Number(e[1]);break}}if(!s&&o){const t=[];if(o.querySelectorAll('a[href*="/f"][href*="p"]').forEach(e=>{const r=(e.getAttribute("href")||"").match(/\/f\d+p(\d+)-/i);r&&t.push(Number(r[1]))}),t.length){const e=Math.min(...t.filter(t=>t>0));Number.isFinite(e)&&(s=e)}}return s||(s=r),n.page_size_detected=s,n}const _=t=>{const e=t.querySelector("h1.page-title, h1, .page-title"),r=c(e)||(e?.textContent||"").trim()||void 0;let n;const o=t.querySelector('link[rel="canonical"]')?.getAttribute("href")||"";n=(t=>{const e={};if(!t)return e;const r=t.match(/\/t(\d+)/)||t.match(/[?&]t=(\d+)/),n=t.match(/#p?(\d+)$/),o=t.match(/\/f(\d+)-/);return r&&(e.topic_id=Number(r[1])),n&&(e.post_id=Number(n[1])),o&&(e.forum_id=Number(o[1])),e})(o).forum_id;const s=o;return{name:r,forum_id:Number.isFinite(n)?n:void 0,forumHref:s}};function v(t,{pageSizeOverride:e,defaultPageSize:r=50}={}){const n=_(t),o=(t=>{const e=["tr.topic","tr.rowtopic","li.topic","div.topic","div.topics li","a.topictitle",".topicslist_row.row"];let r=0;for(const n of e){const e=t.querySelectorAll(n).length;r=Math.max(r,e)}return r||void 0})(t),s=(t=>({can_post:!!t.querySelector('a[href*="mode=newtopic"], a[href*="post?f="], .button-newtopic, .btn-newtopic')||!!t.querySelector('form[action*="mode=newtopic"], form[action*="/post"]')}))(t),i=w(t,{pageSizeOverride:e,defaultPageSize:r}),a=Number.isFinite(i.total)&&Number.isFinite(i.page_size_detected)?i.total*i.page_size_detected:void 0;return{id:n.forum_id,name:n.name,topics_count:a??o,href:n.forumHref||void 0,pagination:{current:i.current,total:i.total,page_size:i.page_size_detected,topics_estimated:a,topics_visible:o||void 0},permissions:s}}function N(t,{pageSizeOverride:e,defaultPageSize:r=25}={}){const n=extractDiscussion(t)[0]||null;extractBreadcrumbs(t)[0];const o=n?.headline||t.querySelector("h1.page-title")?.textContent?.trim()||null,s=t.querySelector('link[rel="canonical"]')?.href||null,i=function(t){try{const e=("string"==typeof t?t:t?.href||"").match(/\/[ftc](\d+)(?:[p]\d+)?-([a-z0-9-]+)/i);return e?{id:Number(e[1]),slug:e[2]}:{}}catch{return{}}}(s),a=s||null,u=i.id||null,c=function(t){const e=[".postbody"];let r=0;for(const n of e){const e=t.querySelectorAll(n).length;r=Math.max(r,e)}return r||void 0}(t),d=w(t,{pageSizeOverride:e,defaultPageSize:r}),p=Number.isFinite(d.total)&&Number.isFinite(d.page_size_detected)?d.total*d.page_size_detected:void 0;return{id:u,url:a,slug:i.slug||null,title:o,pagination:{current:d.current,total:d.total,page_size:d.page_size_detected,replies_estimated:p,replies_visible:c||void 0},replies_count:p??c}}function S(t){const e={};return t.querySelectorAll("ul a").forEach(t=>{const r=t.innerText.replace(/[^a-zA-Z]/gi,"");e[r]=c(t.parentNode).replace(/^:/gi,"").trim()}),e.FORUMAGETYPE="jours",e.NOWDAY=(new Date).getDate(),e.NOWMONTH=(new Date).getMonth()+1,e.NOWYEAR=(new Date).getFullYear(),e.NOWHOUR=(new Date).getHours(),e.NOWMINUTE=(new Date).getMinutes(),e.FORUMLASTUSERLINK=e.FORUMLASTUSERLINK.replace(e.FORUMURLINK,""),e.USERLINK=e.USERLINK.replace(e.FORUMURLINK,""),e.FORUMLASTUSERID=e.FORUMLASTUSERLINK.replace(/[^0-9]/gi,""),{misc:e}}async function A(t={}){const e=document,r=!!t?.stats,o=function(t=document){return y(t,["DiscussionForumPosting"]).byType.DiscussionForumPosting||[]}(e)[0]||null,s=function(t=document){return y(t,["BreadcrumbList"]).byType.BreadcrumbList||[]}(e)[0]||null,i=location,a=i.hash?i.hash.substring(1):null,u="undefined"!=typeof _userdata?_userdata:{},c="undefined"!=typeof _board?_board:{},d={board:{tpl:u.tpl_used,reputation_active:Number(c.reputation_active)},page:{url:i.href,type:n.pagetype,id:n.resid,number:n.pagenum,charset:n.charset,anchor:a},user:{t_id:n.tid,name:u.username,id:Number(u.user_id)||void 0,is_logged:1===Number(u.session_logged_in),is_guest:-1===Number(u.user_id),is_admin:1==Number(u.user_level),is_mod:(Number(u.user_level)||0)>0,lang:u.user_lang,notifications:Number(u.notifications),avatar:u.avatar,avatar_link:u.avatar_link,posts:Number(u.userposts)||void 0,privmsgs_count:Number(u.user_nb_privmsgs)||void 0,group_color:u.groupcolor},schema:{discussion:o,breadcrumbs:s}};if(r){const e=await async function({scope:t="auto",fetchExtra:e=[],forum:r={},topic:o={}}={}){const s=performance.now(),i=new Set,a={},u=document,c="auto"===t?n.pagetype||"auto":t,d=[{url:"/popup_help.forum?l=miscvars&i=mes_txt",callback:S},...e];("topic"===c||"auto"===c&&"forum"===n.pagetype)&&(a.topic="topic"===n.pagetype?N(u,o):void 0),"forum"!==c&&"auto"!==c||(a.forum="forum"===n.pagetype?v(u,r):void 0);for(const{url:t,callback:e}of d)try{const r=await fetch(t,{credentials:"same-origin"});i.add(t);const n=r.headers.get("content-type")||"";let o;if(n.includes("html")){const t=await r.text();o=(new DOMParser).parseFromString(t,"text/html")}else o=n.includes("json")?await r.json():await r.text();const s=await e(o);if(s&&"object"==typeof s)for(const[t,e]of Object.entries(s))"object"==typeof e&&"object"==typeof a[t]?a[t]={...a[t],...e}:a[t]=e;Object.assign(a,s)}catch(t){console.error("Error fetching extra data:",t)}return a.computed_at=(new Date).toISOString(),a.elapse_ms=Math.round(performance.now()-s),a.sources=Array.from(i),a}({scope:t.scope||"auto",fetchExtra:t.fetchExtra||[],forum:{}});d.stats=e}return d}const E="__MODERACTOR_ENV__",x=()=>"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{};function F(){if(O._env)return O._env;const t=x();return t[E]?O._env=t[E]:null}function k(t={}){return function(t){const e=x();O._env=t;try{e[E]=t}catch{}return t}(A(t))}const O={get env(){return F()??k({stats:!0})},set env(t={}){return k(t)},forum:t=>{F()||k({stats:!0}),new p(t,i)},topic:t=>{F()||k({stats:!0}),new l(t,i)},post:t=>{F()||k({stats:!0}),new m(t,i)},user:t=>{F()||k({stats:!0}),new f(t,i)},chat:()=>{F()||k({stats:!0}),new h(i)},adapter:i};return"undefined"!=typeof window&&(window.Moderactor=O),O}();
//# sourceMappingURL=moderactor.js.map
